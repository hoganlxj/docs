---
title: "块存储"
linktitle: "块存储"
date: 2019-08-29T20:30:37+08:00
weight: 1
description: >
    块存储用于存储虚拟机和裸金属等系统盘和数据盘的磁盘文件。
---

块存储用于存储虚拟机和裸金属等系统盘和数据盘的磁盘文件。块存储属于域资源。

块存储主要可以分为两大类：

- 本地存储：物理机和宿主机等服务器上的本地存储。
- 网络存储：支持网络附属存储、共享存储、分布式存储等。
  - NFS：Network File System，网络文件系统。
  - Ceph：分布式存储系统。
  - GPFS：General Parallel File System，共享文件系统
  - Sheepdog：分布式存储系统
  - NAS：Network Attached Storage，网络附属存储。
  - vSAN：分布式存储，供vSphere集群使用。

**入口**：在云管平台单击左上角![](../../images/intro/nav.png)导航菜单，在弹出的左侧菜单栏中单击 **_"存储/块存储/块存储"_** 菜单项，进入块存储页面。

![](../../images/storage/blockstorage.png)


## 新建存储

该功能用于连接Ceph分布式存储、NFS网络文件系统以及GPFS共享存储，存储创建完成后还需要关联宿主机操作才能被用户使用。

{{% alert title="说明" %}}
在新建存储桶页面，可单击顶部“宿主机”、“物理机”页签，切换宿主机或者物理机上的块存储。
{{% /alert %}}

1. 单击列表上方 **_"新建"_** 按钮，弹出新建存储对话框。
2. 配置以下参数：
   - 指定域：选择存储的所属域。
   - 区域 ：设置区域和可用区。
   - 名称：存储的名称。
   - 介质类型：存储设备的介质类型，包括机械盘、固态盘和混合盘。性能固态盘>混合盘>机械盘。
   - 存储类型：包括Ceph、NFS、GPFS三种。若要添加本地存储类型，请参考[如何添加和删除本地存储](../../../function_principle/onpremise/storage/blockstorage/add-storage)
      - 当选择存储类型为"Ceph“时，配置以下参数。Ceph类型存储要求本地数据中心存在Ceph存储集群。
          - Ceph Mon Host：Ceph存储的监控节点的IP地址。
          - Ceph Key：Ceph存储集群默认启用密钥认证，Ceph Key即用户的密钥，格式为为“AQDsBh5b1CtoHxAA9atFhYn1cPBJvPCpoRVo/g==”形式的字符串。可通过以下命令获取Ceph存储的用户密钥。

            ```bash
            $ cat ceph.client.admin.keyring | grep key
            ```

          - Ceph Pool：Ceph存储的存储池。
      - 当选择存储类型为"NFS“时，配置以下参数。NFS类型存储要求本地数据中心存储NFS网络存储服务器。
          - NFS Host：NFS服务器的IP地址。
          - NFS Shared Dir：NFS服务器设置的共享目录。
      - 当选择存储类型为”GPFS“时，无需配置任何参数。GPFS类型存储要求本地数据中心存在共享存储，并且需挂载存储的宿主机已关联该存储。
3. 单击 **_"确定"_** 按钮，完成操作。

## 启用

该功能用于启用"禁用"状态的块存储，禁用状态的存储无法提供存储服务。

**单个启用**

1. 在块存储页面，单击"禁用"状态的块存储右侧操作列 **_"启用"_** 按钮，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，启用存储。

**批量启用**

1. 在存储列表中勾选一个或多个"禁用"状态的存储，单击列表上方 **_"启用"_** 按钮，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，启用存储。

## 禁用

该功能用于禁用”启用“状态的块存储。

**单个禁用**

1. 在块存储页面，单击”启用“状态的块存储右侧操作列 **_"禁用"_** 按钮，禁用存储。

**批量禁用**

1. 在存储列表中勾选一个或多个”启用“状态的存储，单击列表上方 **_"禁用"_** 按钮，禁用存储。

## 管理宿主机

该功能用于将Ceph、GPFS、NFS类型的存储关联或取消关联宿主机。

### 关联宿主机

该功能用于将Ceph、GPFS、NFS类型的存储关联到宿主机上，供宿主机使用。

{{% alert title="说明" %}}
关联宿主机有如下要求：

- Ceph存储关联宿主机时，不需要挂载点，支持批量关联多个宿主机。
- NFS存储关联宿主机时，如果多个宿主机挂载点一样，可以批量关联多个宿主机，宿主机上可以不存在挂载点。
- GPFS存储关联宿主机时，实际宿主机上已关联了GPFS存储，平台上的关联操作仅为了可以创建虚拟机时可以使用GPFS存储，不影响实际挂载操作。其中GPFS存储关联宿主机时的挂载点必须与实际挂载点一致，需要由用户环境的运维人员提供。
{{% /alert %}}

1. 在块存储页面，单击指定块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"管理宿主机"_** 菜单项，进入详情-宿主机页面。
2. 单击列表上方 **_"关联宿主机"_** 按钮，弹出关联宿主机对话框。
3. 选择宿主机以及宿主机上的挂载点，单击 **_"确定"_** 按钮，为宿主机关联存储。

### 取消关联宿主机

该功能用于将块存储取消关联到宿主机。

**取消关联**

1. 在块存储页面，单击指定块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"管理宿主机"_** 菜单项，进入详情-宿主机页面。
2. 单击宿主机右侧操作列 **_"取消关联宿主机"_** 按钮，弹出操作确认对话框。
3. 单击**_"确定"_** 按钮，完成操作。

**批量取消关联宿主机**

1. 在块存储页面，单击指定块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"管理宿主机"_** 菜单项，进入详情-宿主机页面。
2. 在列表中选择一个或多个宿主机，单击列表上方 **_"取消关联宿主机"_** 按钮，弹出操作确认对话框。
3. 单击**_"确定"_** 按钮，完成操作。

## 调整超售比

该功能用于设置存储的超售比。超售即存储提供超过自身拥有的容量大小。存储实际可分配资源为实际资源*超售比。

{{% alert title="说明" %}}
ZStack平台的存储暂不支持调整超售比。
{{% /alert %}}

**单块存储调整超售比**

1. 在块存储页面，单击块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"调整超售比"_** 菜单项，弹出修改属性对话框。
2. 设置超售比，单击 **_"确定"_** 按钮。

**批量调整超售比**

1. 在列表中勾选一个或多个块存储，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"调整超售比"_** 菜单项，弹出修改属性对话框。
2. 分别设置CPU超售比和内存超售比，单击 **_"确定"_** 按钮。

## 调整容量

仅OpenStack平台支持，由于云管平台获取不到OpenStack平台上存储的真正容量，所以云管平台支持设置OpenStack存储容量，请尽量将存储容量设置为存储的真实容量以尽可能的使用存储，避免由于设置的容量超出存储的真实容量而导致磁盘创建失败。

1. 在块存储页面，单击OpenStack平台上指定块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"调整容量"_** 菜单项，弹出调整容量对话框。
2. 设置容量大小，单击 **_"确定"_** 按钮。

## 修改属性

该功能用于调整块存储的参数信息以及超售比。超售比为虚拟容量与实际容量的比值。

1. 在块存储页面，单击指定块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"修改属性"_** 菜单项，弹出修改属性对话框。
2. 支持修改以下参数：
    - 当选择Ceph类型存储时，支持修改Ceph Key（Ceph用户的密钥）、介质类型；
    - 当选择NFS类型存储时，支持修改NFS Host（NFS服务器IP地址）、NFS Shared Dir（NFS的共享目录）、介质类型；
    - 当选择其它类型存储时，仅支持修改介质类型。
3. 单击 **_"确定"_** 按钮。

## 调整调度标签

该功能用于为块存储绑定调度标签，绑定调度标签的块存储将会按照调度标签为虚拟机提供存储。

1. 在块存储页面，单击指定块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"调整调度标签"_** 菜单项，弹出调整调度标签对话框。
2. 选择调度标签，单击 **_"确定"_** 按钮。

## 更改域

该功能用于更改块存储的所属域。

{{% alert title="说明" %}}
更改域的条件：需同时满足

- 当前用户在管理后台。
- 在{{<oem_name>}}已开启三级权限。
- 存储的共享范围为私有。
- 存储类型不为本地存储。
{{% /alert %}}

**单个块存储更改域**

1. 在块存储页面，单击块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"更改域"_** 菜单项，弹出更改域对话框。
2. 选择块存储所属的域，单击 **_"确定"_** 按钮。

**批量更改域**

1. 在块存储页面中勾选一个或多个块存储，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"更改域"_** 菜单项，弹出更改域对话框。
2. 选择块存储所属的域，单击 **_"确定"_** 按钮。


## 设置共享

该功能用于设置块存储的共享范围。

域资源的共享范围有三种：

- 不共享（私有）：即域资源只能本域的用户可以使用。
- 域共享-部分（多域共享）：即域资源可以共享到指定域（一个或多个），只有域资源所在域和共享域下的用户可以使用域资源。
- 域共享-全部（全局共享）：即域资源可以共享给全部域使用，即系统中所有用户都可以使用域资源。

{{% alert title="说明" %}}
设置共享的条件：需同时满足

- 当前用户在管理后台。
- 在{{<oem_name>}}已开启三级权限。
{{% /alert %}}

{{% alert title="注意" color="warning" %}}
本地存储的共享范围要始终要与宿主机的共享范围保持一致。
{{% /alert %}}

**单个块存储设置共享**

1. 在块存储页面，单击块存储右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"设置共享"_** 菜单项，弹出设置共享对话框。
2. 配置以下参数：
   - 当共享范围选择为“不共享”时，即域资源的共享范围为私有，仅本域的用户可以使用。
   - 当共享范围选择为“域共享”时，需要选择共享的域。
       - 当域选择其中的一个或多个域时，即域资源的共享范围为域共享-部分，只有域资源所在域和共享域下的用户可以使用域资源。
       - 当域选择全部时，即域资源的共享范围为域共享-全部，系统中的所有用户都可以使用域资源。
3. 单击 **_"确定"_** 按钮，完成操作。

**批量设置共享**

1. 在块存储页面中选择一个或多个块存储，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"设置共享"_** 菜单项，弹出设置共享对话框。
2. 配置以下参数：
   - 当共享范围选择为“不共享”时，即域资源的共享范围为私有，仅本域的用户可以使用。
   - 当共享范围选择为“域共享”时，需要选择共享的域。
       - 当域选择其中的一个或多个域时，即域资源的共享范围为域共享-部分，只有域资源所在域和共享域下的用户可以使用域资源。
       - 当域选择全部时，即域资源的共享范围为域共享-全部，系统中的所有用户都可以使用域资源。
3. 单击 **_"确定"_** 按钮，完成操作。

## 删除

该功能用于删除块存储。当块存储未关联宿主机、且存储下没有硬盘文件和缓存文件时可删除。

{{% alert title="说明" %}}
- 本地存储不支持删除。
- 若块存储未关联宿主机、且存储下没有硬盘文件和缓存文件，仍删除不了存储，可能是硬盘文件未彻底删除存放在回收站中，请在回收站中清除硬盘。
{{% /alert %}}

1. 在块存储页面，根据需要删除块存储的数量，选择删除方式。
    - 删除单个块存储：单击指定块存储右侧操作列 **_更多_** 按钮，选择下拉菜单 **_"删除"_** 菜单项，在弹出操作确认对话框中单击 **_"确定"_** 按钮。
    - 删除多个块存储：在存储列表中勾选一个或多个存储，单击列表上方 **_删除_** 按钮，在弹出操作确认对话框中单击 **_"确定"_** 按钮。

## 查看块存储详情

该功能用于查看块存储详细信息。

1. 在块存储页面，单击指定块存储名称项，进入块存储详情页面。
2. 详情页面顶部菜单项支持对块存储进行启用、禁用、关联宿主机、调整容量、修改属性、调整标签以及删除操作。
3. 查看以下信息：
    - 基本信息：查看块存储的云上ID、ID、名称、状态、域、项目、共享范围、平台、启用状态、存储类型、介质类型、区域、可用区、云账号、创建时间、更新时间、备注等。
    - 用量统计：查看块存储的物理容量（已分配/总量）、超售比、虚拟容量（虚拟容量=实际容量*超售比）、分配率、分配、预留、浪费容量。

### 查看块存储挂载的宿主机信息

该功能用于查看块存储管理的宿主机的信息，支持关联宿主机和取消关联宿主机操作。

{{% alert title="说明" %}}
- 本地存储不支持取消关联宿主机。
{{% /alert %}}

1. 在块存储详情页面，单击”宿主机“页签，进入宿主机页面。
2. 查看宿主机的名称、启用、状态、IP、服务、#VM（虚拟机数量）、CPU（数量和使用率）、内存（数量和使用率）、存储、SN（序列号）信息。
3. 根据需要取消关联块存储的主机数量，选择取消关联宿主机方式。
    - 取消关联单个宿主机：单击指定宿主机右侧操作列 **_取消关联宿主机_** 按钮，在弹出的操作确认对话框中，单击 **_"确定"_** 按钮。
    - 批量取消关联宿主机：在宿主机列表选择一个或多个宿主机，单击列表上方 **_取消关联宿主机_** 按钮，在弹出的操作确认对话框中，单击 **_"确定"_** 按钮。
4. 除取消关联操作外，支持对裸金属服务器进行管理操作，具体操作使用方法请参考[宿主机](../..../../../computing/resources/host)。

### 查看硬盘信息

该功能用于查看使用块存储创建的虚拟机硬盘信息，并支持删除硬盘。

1. 在块存储详情页面，单击”硬盘“页签，进入硬盘页面。
2. 查看硬盘信息，包括名称、容量、格式、磁盘类型、虚拟机、是否挂载、状态信息等。
3. 支持对硬盘进行管理操作，具体操作使用方法请参考[硬盘](../../computing/storage/disk)。

### 查看回收站信息

该功能用于查看目前处于回收站中的使用块存储创建的虚拟机硬盘信息。并支持清除和恢复操作。

1. 在块存储详情页面，单击“回收站”页签，进入回收站页面。
2. 查看目前处于回收站的硬盘信息，包括名称、类型、虚拟机、状态等。
3. 支持对回收站中的硬盘进行清除和恢复操作，具体操作使用方法请参考[硬盘回收站](../../computing/recovery/diskrecovery)。

### 查看镜像缓存

镜像缓存即在存储上创建的虚拟机使用的镜像缓存信息，当关联镜像的虚拟机删除后可以释放镜像缓存，清理存储空间。

1. 在块存储详情页面，单击”镜像缓存“页签，进入镜像缓存页面。
2. 查看镜像缓存信息，包括名称、文件大小、状态、路径、引用（使用该镜像缓存的虚拟机数量）等信息
3. 释放缓存：单击镜像缓存指定操作列 **_释放缓存_** 按钮，在弹出的操作确认对话框中单击 **_"确定"_** 按钮。

### 查看操作日志

该功能用于查看块存储相关操作的日志信息

1. 在块存储详情页面，单击“操作日志”页签，进入操作日志页面。
    - 加载更多日志：列表默认显示20条操作日志信息，如需查看更多操作日志，请单击 **_"加载更多"_** 按钮，获取更多日志信息。
    - 查看日志详情：单击操作日志右侧操作列 **_"查看"_** 按钮，查看日志的详情信息。支持复制详情内容。
    - 查看指定时间段的日志：如需查看某个时间段的操作日志，在列表右上方的开始日期和结束日期中设置具体的日期，查询指定时间段的日志信息。
    - 导出日志：目前仅支持导出本页显示的日志。单击右上角![](../../images/system/download.png)图标，在弹出的导出数据对话框中，设置导出数据列，单击 **_"确定"_** 按钮，导出日志。
