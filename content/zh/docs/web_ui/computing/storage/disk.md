---
title: "硬盘"
weight: 1
description: 硬盘是虚拟机的存储文件。
---

硬盘是虚拟机的存储文件。硬盘根据位置可分为本地硬盘和云硬盘，其中要求本地硬盘与虚拟机处于同一宿主机。本地硬盘不支持在硬盘列表中新建、挂载和卸载。要求云硬盘与虚拟机处于相同可用区，云硬盘支持新建、挂载、卸载、扩容、删除等操作。

**入口**：在云管平台单击左上角![](../../../images/intro/nav.png)导航菜单，在弹出的左侧菜单栏中单击 **_"主机/存储/硬盘"_** 菜单项，进入硬盘页面。

  ![](../../../images/computing/disk1.png)

## 新建硬盘

该功能用于创建硬盘，新创建的硬盘需要挂载到虚拟机上才能正常使用。

{{% alert title="说明" %}}
在新建硬盘页面，可单击顶部“本地IDC”、“私有云”、“公有云”页签，切换创建不同平台上的硬盘。
{{% /alert %}}

### 新建本地IDC硬盘

在本地IDC新建硬盘之前请先配置Ceph、NFS、GPFS等共享存储。

1. 在硬盘页面，单击顶部“全部”或“本地IDC”页签，单击列表上方 **_"新建"_** 按钮，进入新建硬盘页面。
2. 配置以下参数：
   - 指定项目：管理员和域管理员在新建硬盘时需要指定硬盘所属的项目。
   - 区域：选择区域和可用区。
   - 名称：设置硬盘的名称。
   - 备注：硬盘的备注。
   - 硬盘：选择磁盘类型并设置磁盘的容量大小。
   - 指定虚拟机：选择硬盘指定具体的虚拟机新建。
   - 磁盘加密：默认关闭，启用磁盘加密后，磁盘将被所选的密钥加密。
   - 标签：支持为新建的硬盘绑定标签。支持选择已有标签和新建标签。
     - 新建标签：单击列表上方 **_新建_** 按钮，设置标签键和标签值，单击 **_"添加"_** 按钮，新建标签并绑定到资源上。
     - 选择已有标签：单击 **_"已有标签"_** 按钮，选择标签键和值。
3. 单击 **_"确定"_** 按钮，完成操作。

{{% alert title="注意" color="warning" %}}
- 仅{{<oem_name>}}平台支持指定虚拟机
- 在管理后台视图下，支持选择宿主机和宿主机下的具体虚拟机新建硬盘；在域管理后台视图和项目视图下，仅支持选择具体的虚拟机新建硬盘。
{{% /alert %}}

### 新建私有云平台硬盘

在新建私有云平台硬盘之前请确保有对应平台的云账号。

1. 在硬盘页面，单击顶部“私有云”页签，单击列表上方 **_"新建"_** 按钮，弹出新建硬盘对话框。
2. 配置以下参数：
   - 指定项目：管理员和域管理员在新建硬盘时需要指定硬盘所属的项目。
   - 区域：选择区域和可用区。可通过区域确定私有云所属平台以及创建硬盘使用的私有云云账号。
   - 名称：设置硬盘的名称。
   - 备注：硬盘的备注。
   - 硬盘：选择磁盘类型并设置磁盘的容量大小。
   - 磁盘加密：默认关闭，启用磁盘加密后，磁盘将被所选的密钥加密。
   - 标签：支持为新建的硬盘绑定标签。支持选择已有标签和新建标签。
     - 新建标签：单击列表上方 **_新建_** 按钮，设置标签键和标签值，单击 **_"添加"_** 按钮，新建标签并绑定到资源上。
     - 选择已有标签：单击 **_"已有标签"_** 按钮，选择标签键和值。
3. 单击 **_"确定"_** 按钮，完成操作。


### 新建公有云平台硬盘

在新建公有云平台硬盘之前请确保有对应平台的云账号。

1. 在硬盘页面，单击顶部“公有云”页签，单击列表上方 **_"新建"_** 按钮，弹出新建硬盘对话框。
2. 配置以下参数：
   - 指定项目：管理员和域管理员在新建硬盘时需要指定硬盘所属的项目。
   - 区域：可通过平台、区域、可用区确定硬盘所属的平台和可用区。
   - 名称：设置硬盘的名称。
   - 备注：硬盘的备注。
   - 硬盘：选择磁盘类型并设置磁盘的容量大小。
   - 磁盘加密：默认关闭，启用磁盘加密后，磁盘将被所选的密钥加密。
   - 标签：支持为新建的硬盘绑定标签。支持选择已有标签和新建标签。
     - 新建标签：单击列表上方 **_新建_** 按钮，设置标签键和标签值，单击 **_"添加"_** 按钮，新建标签并绑定到资源上。
     - 选择已有标签：单击 **_"已有标签"_** 按钮，选择标签键和值。
   - 高级配置：单击“高级配置”超连接，展开高级配置选项，设置预算的条件等。
     - 指定云订阅：指定创建硬盘的云订阅。
3. 单击 **_"确定"_** 按钮，完成操作。
  
{{% alert title="注意" color="warning" %}}
当在腾讯云平台创建磁盘时，磁盘容量大小必须为10的倍数。否则会创建失败。
{{% /alert %}}

## 硬盘扩容

该功能用于扩展系统盘或数据盘的大小以满足数据增长的需求。下表列出不同平台对于硬盘扩容的条件。硬盘扩容不支持减少硬盘容量。

1. 在硬盘页面，单击硬盘右侧操作列 **_"扩容"_** 按钮，弹出扩容对话框。
2. 调整硬盘容量，单击 **_"确定"_** 按钮。

| 平台      | 扩容限制                                             |
| --------- | ---------------------------------------------------- |
| {{<oem_name>}}  | 无要求                                               |
| VMware    | 系统盘仅支持关机扩容，数据盘无要求，若硬盘已有主机快照，则不允许扩容                               |
| ZStack    | 硬盘挂载的虚拟机处于运行中或关机状态；             |
| OpenStack | 只支持数据盘；                                       |
| 阿里云    | 只支持数据盘；硬盘挂载的虚拟机处于运行中或关机状态 |
| AWS       | 无要求                                               |
| Azure     | 硬盘挂载的虚拟机不处于运行中状态                   |
| 腾讯云    | 只支持扩容数据盘                                     |
| 华为云    | 硬盘挂载的虚拟机处于运行中或关机状态               |
| UCloud    | 硬盘挂载的虚拟机处于关机状态                       |

## 挂载

该功能用于将待挂载状态的硬盘挂载到虚拟机上，供虚拟机使用。

1. 在硬盘页面，单击硬盘右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"挂载"_** 菜单项，弹出挂载对话框。
2. 选择虚拟机后，单击 **_"确定"_** 按钮。
3. 磁盘挂载成功后，需要登录到虚拟机中对挂载的磁盘进行分区格式化和挂载新分区的操作。

## 卸载

该功能是将挂载到虚拟机中的数据盘取消与虚拟机的关联，卸载的硬盘可挂载到其他虚拟机中。只支持卸载数据盘。如虚拟机为Linux系统，在卸载硬盘之前请先在虚拟机中等待umount命令执行成功后再卸载硬盘。

1. 在硬盘页面，单击硬盘右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"卸载"_** 菜单项，弹出卸载确认对话框。
2. 单击 **_"确定"_** 按钮，完成操作。

## 新建快照

该功能用于为硬盘进行数据备份，创建快照的硬盘当故障后可恢复到快照之前的状态。

{{% alert title="注意" color="warning" %}}

- VMware平台、UCloud平台的硬盘不支持创建快照。
- 硬盘所属虚拟机状态异常或硬盘未挂载到虚拟机时不支持创建快照

{{% /alert %}}

1. 在硬盘页面，单击硬盘右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"新建快照"_** 菜单项，弹出新建快照对话框。
2. 设置快照名称，单击 **_"确定"_** 按钮，创建快照。

## 设置自动快照

该功能用于为硬盘设置自动快照策略，设置完成后，硬盘将会在自动快照策略指定的时间点周期性的创建自动快照。

1. 在硬盘页面，单击硬盘右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"设置自动快照"_** 菜单项，弹出设置自动快照对话框。
2. 开启自动快照：
   1. 勾选开启自动快照，并选择自动快照策略名称，如没有符合需求的自动快照策略，可单击右侧“创建自定义快照策略”超链接，在弹出的新建策略中配置相关参数，单击 **_"确定"_** 按钮，创建自动快照策略。
   2. 自动快照策略选择完成后，单击 **_"确定"_** 按钮。
3. 关闭自动快照：勾选关闭自动快照，单击 **_"确定"_** 按钮。

## 修改驱动

该功能用于修改磁盘驱动，修改后需要重启虚拟机生效。

1. 在硬盘页面，单击硬盘右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"修改驱动"_** 菜单项，弹出修改磁盘驱动对话框。
2. 修改以下参数：
    - 缓存模式：设置磁盘的缓存模式，包括none、writethrough、writeback等。
        - none：即直接访问宿主机磁盘；
        - writethrough：不使用任何缓存，直接操作磁盘写，只有数据被写入磁盘才会返回成功。虽然保持了数据一致性，但是因为磁盘的写入速度很慢，所以该模式下写速度很慢，但是读速度较高。无需刷盘。
        - writeback：将数据写入宿主机页面缓存则返回写成功。页面缓存再合并数据写磁盘。虚机磁盘控制器也知道使用了back cache，所以为了保持数据一致性（虚机侧数据新，磁盘侧数据旧），在需要的时候，虚机会发送刷盘（将缓存里的数据强制持久化到磁盘。）指令。
    - 磁盘驱动：设置磁盘驱动，包括vitro、ide、scsi、pvscsi。
3. 单击 **_"确定"_** 按钮，完成操作。

## 更改项目

该功能用于更改未挂载磁盘的所属项目。

1. 在硬盘页面，单击硬盘右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"更改项目"_** 菜单项，弹出更改项目对话框。
2. 选择域和项目，单击 **_"确定"_** 按钮。

## 同步状态

该功能用于获取硬盘的当前状态。

**单个同步状态**

1. 在硬盘页面，单击硬盘右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"同步状态"_** 菜单项，同步硬盘状态。

**批量同步状态**

1. 在硬盘列表中选择一个或多个硬盘，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"同步状态"_** 菜单项，同步硬盘状态。

## 删除

支持单个和批量删除硬盘，当磁盘未被挂载时，才可以删除。

{{% alert title="注意" color="warning" %}}
- OpenStack平台上硬盘以及Ceph盘存在快照时不允许删除；
- 包年包月类型的硬盘不支持删除。
- 阿里云、腾讯云、华为云、AWS、Azure、Google、Zstack、Dstack、OpenStack、{{<oem_name>}}等平台支持删除硬盘时同时删除快照。
- 华为云删除硬盘时会同时删除硬盘快照；
- {{<oem_name>}}平台删除Ceph盘时会同时删除硬盘快照；
{{% /alert %}}

**单个删除**

1. 在硬盘页面，单击硬盘右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"删除"_** 菜单项，弹出操作确认对话框。
2. 可勾选删除快照，单击 **_"确定"_** 按钮，完成操作。

**批量删除**

1. 在硬盘列表中选择一个或多个硬盘，单击列表上方的 **_"删除"_** 按钮，弹出操作确认对话框。
2. 可勾选删除快照，单击 **_"确定"_** 按钮，完成操作。

## 查看硬盘详情

该功能用于查看硬盘的详细信息、硬盘创建的快照信息以及日志信息。

1. 单击硬盘名称项，进入硬盘详情页面。
2. 详情页面顶部菜单项支持对硬盘进行管理操作。
3. 查看硬盘的云上ID、ID、名称、状态、域、项目、平台、计费方式、容量、磁盘类型、是否挂载、格式、介质类型、虚拟机（名称和状态）、存储、快照策略、区域、可用区、云账号、创建时间、更新时间、备注等。

## 快照管理

该功能用于管理硬盘上的快照信息等。

### 回滚硬盘

该功能用于将虚拟机的硬盘回滚到创建快照时的状态。回滚硬盘之前需要确保硬盘关联的虚拟机处于关机状态。

1. 单击硬盘名称项，进入硬盘详情页面。
2. 单击“快照”页签，进入快照页面。
3. 单击快照右侧操作列 **_"回滚硬盘"_** 按钮，弹出回滚硬盘对话框。   
4. 单击 **_"确定"_** 按钮，将硬盘回滚到快照时刻。

### 同步状态

该功能用于获取硬盘快照的当前状态。

**单个同步状态**

1. 单击硬盘名称项，进入硬盘详情页面。
2. 单击“快照”页签，进入快照页面。
3. 单击硬盘快照右侧操作列 **_"同步状态"_** 按钮，同步硬盘快照的状态。

**批量同步状态**

1. 单击硬盘名称项，进入硬盘详情页面。
2. 单击“快照”页签，进入快照页面。
3. 在快照列表中选择一个或多个硬盘快照，单击列表上方 **_"同步状态"_** 按钮，批量同步状态。

### 删除

该功能用于删除硬盘快照。

**单个删除**

1. 单击硬盘名称项，进入硬盘详情页面。
2. 单击“快照”页签，进入快照页面。
3. 单击快照右侧操作列 **_"删除"_** 按钮，弹出操作确认对话框。
4. 单击 **_"确定"_** 按钮，完成操作。

**批量删除**

1. 单击硬盘名称项，进入硬盘详情页面。
2. 单击“快照”页签，进入快照页面。
3. 在快照列表中选择一个或多个快照，单击列表上方 **_"删除"_** 按钮，弹出操作确认对话框。
4. 单击 **_"确定"_** 按钮，完成操作。

## 查看操作日志

该功能用于查看硬盘相关操作日志信息。

1. 在硬盘详情页面，单击“操作日志”页签，进入操作日志页面。
    - 加载更多日志：列表默认显示20条操作日志信息，如需查看更多操作日志，请单击 **_"加载更多"_** 按钮，获取更多日志信息。
    - 查看日志详情：单击操作日志右侧操作列 **_"查看"_** 按钮，查看日志的详情信息。支持复制详情内容。
    - 查看指定时间段的日志：如需查看某个时间段的操作日志，在列表右上方的开始日期和结束日期中设置具体的日期，查询指定时间段的日志信息。
    - 导出日志：目前仅支持导出本页显示的日志。单击右上角![](../../../images/system/download.png)图标，在弹出的导出数据对话框中，设置导出数据列，单击 **_"确定"_** 按钮，导出日志。
