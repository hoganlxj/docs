---
title: "VPC"
weight: 2
description: 专有网络VPC是一块逻辑隔离的网络空间。
---

专有网络VPC（Virtual Private Cloud）是一块逻辑隔离的网络空间。

- VPC网络：VPC是一块逻辑隔离的网络空间，在VPC内，用户可以自由定义网段划分、IP地址。在不同VPC上可以使用相同的内网IP。
- 经典网络：所有用户共享网络资源池，即宿主机、物理机以及虚拟机等共享网络资源池，相同的内网IP无法分配给不同用户。

**入口**：在云管平台单击左上角![](../../../images/intro/nav.png)导航菜单，在弹出的左侧菜单栏中单击 **_"网络/基础网络/VPC"_** 菜单项，进入VPC页面。

  ![](../../../images/network/vpc1.png)

## 新建VPC

该功能用于创建专有网络VPC。

{{% alert title="说明" %}}
在新建VPC页面，可单击顶部“本地IDC”、“私有云”、“公有云”页签，切换创建不同平台上的VPC。
{{% /alert %}}

### 新建本地IDC的VPC

{{<oem_name>}}平台创建完成后默认创建Default VPC（实际为经典网络），新建本地IDC的VPC为VPC网络。仅本地IDC上的{{<oem_name>}}平台的虚拟机支持使用新建的VPC网络，VMware虚拟机以及物理机、宿主机等还是使用经典网络的IP子网。

1. 在VPC页面，单击顶部“全部”或“本地IDC”页签，单击列表上方 **_"新建"_** 按钮，进入新建本地IDCVPC页面。
2. 配置以下信息：
   - 指定域：选择VPC的所属域。
   - 名称：设置VPC的名称。
   - 区域：选择VPC所属的区域。
   - 目标网段：设置VPC网络的专用网段，VPC下的IP子网必须使用该网段下的地址，仅支持使用10.0.0.0/8，172.16.0.0/12，192.168.0.0/16网段作为VPC目标网段。
3. 单击 **_"确定"_** 按钮，完成操作。

### 新建私有云平台VPC

仅OpenStack平台支持新建VPC。在新建私有云平台VPC之前请确保有对应平台的云账号。

1. 在VPC页面，单击顶部“私有云”页签，单击列表上方 **_"新建"_** 按钮，进入新建私有云平台VPC页面。
2. 配置以下信息：
   - 指定域：选择VPC的所属域。
   - 名称：设置VPC的名称。
   - 区域：选择VPC所属的区域。可通过区域确定私有云所属平台以及创建硬盘使用的私有云云账号。
   - 目标网段：设置VPC网络的专用网段，VPC下的IP子网必须使用该网段下的地址，支持使用192.168.0.0/16、172.16.0.0/12、10.0.0.0/8及其子网作为VPC目标网段。
3. 单击 **_"确定"_** 按钮，完成操作。

### 新建公有云平台VPC

在新建公有云平台VPC之前请确保有对应平台的云账号。

{{% alert title="注意" color="warning" %}}
- {{<oem_name>}}平台上全局VPC对应Google平台的VPC；VPC对应Google平台的IP子网。因此在{{<oem_name>}}平台新建Google平台VPC即在Google平台VPC下新建IP子网。
{{% /alert %}}

1. 在VPC页面，单击顶部“公有云”页签，单击列表上方 **_"新建"_** 按钮，进入新建公有云平台VPC页面。
2. 配置以下信息：
   - 指定域：选择VPC的所属域。
   - 名称：设置VPC的名称。
   - 区域：选择VPC所属的区域。可通过城市、平台快速过滤筛选出合适区域。
   - 目标网段：设置VPC网络的专用网段，VPC下的IP子网必须使用该网段下的地址。不同公有云支持的目标网段范围不同。详情请参考[公有云平台VPC和IP子网的支持范围](#公有云平台vpc和ip子网的支持范围)。
   - 允许外网访问：当VPC启用外网访问后，VPC下的IP子网都可以通过绑定EIP的方式访问外网。除AWS平台外的公有云平台默认都允许，且不允许修改。当AWS平台VPC不允许外网访问时，使用VPC下IP子网创建的虚拟机不支持绑定EIP，当AWS平台VPC允许外网访问时，将会在AWS平台同步创建互联网网关以及到互联网网关的路由表，使用VPC下IP子网创建的虚拟机可以通过绑定EIP访问外网。
   - 指定云订阅：选择具体创建VPC的云订阅。
   - 全局VPC：仅选择Google平台时需设置该项，即选择Google平台的VPC中创建IP子网。
3. 单击 **_"确定"_** 按钮，完成操作。

#### 公有云平台VPC和IP子网的支持范围

| 平台 | VPC 目标网段掩码范围 | IP 子网网段范围 |
|-----|---------|--------|
| 阿里云 | 10.0.0.0/8~24 <br> 172.16.0.0/12~24 <br> 192.168.0.0/16~24| 10.0.0.0/16~29 <br> 172.16.0.0/16~29 <br> 192.168.0.0/17~29 |
| 腾讯云 | 10.0.0.0/16~28 <br> 172.16.0.0/16~28 <br> 192.168.0.0/16~28 | 10.0.0.0/16~29 <br> 172.16.0.0/16~29 <br> 192.168.0.0/17~29 |
| 华为云 | 10.0.0.0/8~24 <br> 172.16.0.0/12~24 <br> 192.168.0.0/16~24| 10.0.0.0/9~29 <br> 172.16.0.0/13~29 <br> 192.168.0.0/17~29 |
| UCloud | 10.0.0.0/8~29 <br> 172.16.0.0/12~29 <br> 192.168.0.0/16~29| 10.0.0.0/9~29 <br> 172.16.0.0/13~29 <br> 192.168.0.0/17~29 |
| AWS | 掩码范围：16~28 <br> 支持公网私用，但不推荐 | 子网掩码范围： 16~28 |
| Azure | 掩码范围：8~29 <br> 支持公网私用，但不推荐   | 子网掩码范围： 8~29 |
| Google | | 子网掩码范围： 8~29 |

云管平台默认不支持公网私用，会将这类网段判断为公网IP，并占用公网IP的配额。如用户有公网私用的需求，可以通过修改配置文件，兼容公网私用的网段。

```
$ climc service-config-edit common

default:
  api_server: https://10.127.190.254
  # 在配置文件中添加公网私用的网段
  customized_private_prefixes: 
  - 52.0.0.0/16
  - 54.0.0.0/16
  enable_quota_check: true
  non_default_domain_projects: true

```

## 同步状态

该功能用于同步VPC的当前状态。

**单个同步状态**

1. 在VPC页面，单击VPC右侧操作列 **_"同步状态"_** 按钮，同步VPC状态。

**批量同步状态**

1. 在VPC列表中选择一个或多个VPC，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"同步状态"_** 菜单项，批量同步状态。

## 更改域

该功能用于更改VPC的所属域。

{{% alert title="说明" %}}
更改域的条件：需同时满足

- 当前用户在管理后台。
- 在{{<oem_name>}}已开启三级权限。
- VPC的共享范围为私有。
{{% /alert %}}

**单个VPC更改域**

1. 在VPC页面，单击VPC右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"更改域"_** 菜单项，弹出更改域对话框。
2. 选择VPC所属的域，单击 **_"确定"_** 按钮。

**批量更改域**

1. 在VPC列表中勾选一个或多个VPC，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"更改域"_** 菜单项，弹出更改域对话框。
2. 选择VPC所属的域，单击 **_"确定"_** 按钮。


## 设置共享

该功能用于设置VPC的共享范围。

域资源的共享范围有三种：

- 不共享（私有）：即域资源只能本域的用户可以使用。
- 域共享-部分（多域共享）：即域资源可以共享到指定域（一个或多个），只有域资源所在域和共享域下的用户可以使用域资源。
- 域共享-全部（全局共享）：即域资源可以共享给全部域使用，即系统中所有用户都可以使用域资源。

{{% alert title="说明" %}}
设置共享的条件：需同时满足

- 当前用户在管理后台。
- 在{{<oem_name>}}已开启三级权限。
{{% /alert %}}

{{% alert title="注意" color="warning" %}}
- 私有云和公有云的VPC共享范围与云账号的共享范围有关。
    - 当云账号不共享时，通过云账号同步下来的资源也不能共享。
    - 当云账号启用共享时，通过云账号同步下来的资源也将随着云账号启用共享。
    - 当云账号启用共享时，通过云账号同步下来的资源可以更改共享范围，请确保共享范围在云账号的共享范围内。
    - 当云账号修改共享范围时，通过云账号同步下来的资源的共享范围要始终保持在云账号的共享范围内。如云账号共享A、B、C、D域，域资源共享A、C域，云账号修改共享范围为A、B域，则域资源只能共享到A域。
    - 云账号共享云订阅时，通过云账号同步下来的域资源不能共享。
{{% /alert %}}

**单个VPC设置共享**

1. 在VPC页面，单击VPC右侧操作列 **_"更多"_** 按钮，选择下拉菜单 **_"设置共享"_** 菜单项，弹出设置共享对话框。
2. 配置以下参数：
   - 当共享范围选择为“不共享”时，即域资源的共享范围为私有，仅本域的用户可以使用。
   - 当共享范围选择为“域共享”时，需要选择共享的域。
       - 当域选择其中的一个或多个域时，即域资源的共享范围为域共享-部分，只有域资源所在域和共享域下的用户可以使用域资源。
       - 当域选择全部时，即域资源的共享范围为域共享-全部，系统中的所有用户都可以使用域资源。
3. 单击 **_"确定"_** 按钮，完成操作。

**批量设置共享**

1. 在VPC列表中选择一个或多个VPC，单击列表上方 **_"批量操作"_** 按钮，选择下拉菜单 **_"设置共享"_** 菜单项，弹出设置共享对话框。
2. 配置以下参数：
   - 当共享范围选择为“不共享”时，即域资源的共享范围为私有，仅本域的用户可以使用。
   - 当共享范围选择为“域共享”时，需要选择共享的域。
       - 当域选择其中的一个或多个域时，即域资源的共享范围为域共享-部分，只有域资源所在域和共享域下的用户可以使用域资源。
       - 当域选择全部时，即域资源的共享范围为域共享-全部，系统中的所有用户都可以使用域资源。
3. 单击 **_"确定"_** 按钮，完成操作。

## 删除VPC

该功能用于删除VPC，支持单个或批量删除VPC。

{{% alert title="说明" %}}

- 本地IDC的Default专有网络不支持删除；
- 当VPC下有IP子网时不支持删除。
- AWS平台的VPC删除时将会同步删除VPC下的路由表、安全组以及互联网网关。

{{% /alert %}}

**单个删除**

1. 在VPC页面，单击VPC右侧操作列 **_"删除"_** 按钮，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，完成操作。

**批量删除**

1. 在VPC列表中选择一个或多个VPC，单击列表上方 **_"删除"_** 按钮，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，完成操作。

## 查看VPC详情

该功能用于查看VPC的详细信息。

1. 在VPC页面，单击VPC名称项，进入VPC详情页面。
2. 详情页面顶部菜单项支持对VPC进行删除操作。
3. 查看VPC的云上ID、ID、名称、状态、域、项目、共享范围、平台、目标网段、二层网络数量、路由表数量、IP子网数量、nat网关数量、允许外网访问、区域、可用区、云账号、创建时间、更新时间、备注等。

## 查看IP子网信息

该功能用于查看VPC下的IP子网信息。

1. 在VPC页面，单击VPC名称项，进入VPC详情页面。
2. 单击“IP子网”页签，进入IP子网页面。
3. 查看VPC网络下IP子网信息，包括名称、IP地址、VLAN、是否共享、类型、使用情况（总量与使用量）。
4. 右侧操作列支持对IP子网进行管理操作。

## 查看路由表信息

路由表用于控制网络中的路由走向。目前仅支持同步阿里云、华为云、OpenStack平台的路由表。

- 在公有云平台创建专有网络后，系统会自动创建一张默认路由表并为其添加系统路由来管理专有网络的流量，
- OpenStack的路由表实际为路由器的路由表，当用户在OpenStack平台的路由器下创建了路由表将会同步到对应VPC下。

1. 在VPC页面，单击VPC名称项，进入VPC详情页面。
2. 单击“路由表”页签，进入路由表页面。
3. 查看路由表的名称、所属专有网络、区域、云账号、条目（路由表类型 目标网段 下一跳）等信息。

## 查看拓扑

该功能用于查看VPC下的网络拓扑信息。

1. 在VPC页面，单击VPC名称项，进入VPC详情页面。
2. 单击“拓扑”页签，进入拓扑页面。
3. 当VPC为经典网络（Default VPC）时，查看网络拓扑信息。
    - 虚拟拓扑：直观为用户展示二层网络下的IP子网，以及使用IP子网的虚拟机、LB资源。
    - 物理拓扑：直观的为用户展示二层网络下的宿主机资源。
4. 当VPC非经典网络时，查看网络拓扑信息，直观为用户展示当前VPC下的IP子网，以及使用IP子网的虚拟机、LB等资源。

## 查看操作日志

该功能用于查看VPC相关操作的日志信息。

1. 在VPC页面，单击VPC名称项，进入VPC详情页面。
2. 单击“操作日志”页签，进入操作日志页面。
    - 加载更多日志：列表默认显示20条操作日志信息，如需查看更多操作日志，请单击 **_"加载更多"_** 按钮，获取更多日志信息。
    - 查看日志详情：单击操作日志右侧操作列 **_"查看"_** 按钮，查看日志的详情信息。支持复制详情内容。
    - 查看指定时间段的日志：如需查看某个时间段的操作日志，在列表右上方的开始日期和结束日期中设置具体的日期，查询指定时间段的日志信息。
    - 导出日志：目前仅支持导出本页显示的日志。单击右上角![](../../../images/system/download.png)图标，在弹出的导出数据对话框中，设置导出数据列，单击 **_"确定"_** 按钮，导出日志。

