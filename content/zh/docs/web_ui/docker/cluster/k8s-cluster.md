---
title: "集群"
weight: 1
description: 帮助用户快速搭建Kubernetes集群。
---

云管平台支持创建和纳管Kubernetes集群，目前支持以下纳管集群的方式。

- 基于{{<oem_name>}}、Aliyun、AWS 平台的虚拟机创建 Kubernetes 集群。
- 导入已创建的集群，支持纳管 Kubernetes 集群和 OpenShift 集群。

Kubernetes集群是容器运行所需要的云资源的集合。一个Kubernetes集群由1~3个控制节点和n个计算节点组成。

- 控制节点（controlplane）：即Master节点，由三个紧密协作的独立组件组合而成，它们分别是负责API服务的kube-apiserver、负责调度的kube-scheduler，以及负责容器编排的kube-controller-manager。整个集群的持久化数据，则由kube-apiserver处理后保存在Etcd中。
- 计算节点（Node）：用于运行业务的节点，一般情况下用户创建的pod只允许在node节点。

**入口**：在云管平台单击左上角![](../../../images/intro/nav.png)导航菜单，在弹出的左侧菜单栏中单击 **_"容器/集群/集群"_** 菜单项，进入集群页面。

![](../../../images/docker/k8scluster.png)

## 新建集群

该功能可以基于界面快速创建Kubernetes集群。目前仅支持在{{<oem_name>}}、Aliyun、AWS 平台创建虚拟机并部署 Kubernetes 集群。

### 前提条件

- 当界面提示无可用平台时，请确保{{<oem_name>}}、Aliyun、AWS 平台有可用资源创建虚拟机等。
    - 只有{{<oem_name>}}平台中有启用状态的宿主机时，才会显示该平台；
    - Aliyun、AWS 平台有对应云账号时，才会显示该平台；
- 当界面提示没有找到对应平台镜像时，请确保环境中已导入`CentOS-7.6.1810-20190430.qcow2`镜像。
    - 在系统镜像页面，通过上传镜像功能输入镜像URL`https://iso.yunion.cn/vm-images/CentOS-7.6.1810-20190430.qcow2`的方式导入部署k8s集群所需的`CentOS-7.6.1810-20190430.qcow2`镜像。
- 创建容器集群时，请先创建控制节点，支持批量同时创建控制节点和计算节点。

### 操作步骤

1. 在集群页面，单击列表上方 **_"新建"_** 按钮，进入新建集群页面。
2. 设置以下参数：
    - 平台：目前支持{{<oem_name>}}、Aliyun、AWS 平台。
    - 区域：选择容器集群所属的区域和可用区。
    - 名称：设置集群名称。
    - 机器配置：设置虚拟机的配置信息，若需创建不同配置或不同角色的集群，可单击 **_"添加机器"_** 按钮，设置机器配置参数等。
        - CPU：取值范围为2~32核。
        - 内存：取值范围为4~128GB。
        - 磁盘：取值范围为40~500GB。
        - IP子网：要求IP子网中有空闲IP地址，且分配虚拟机的IP地址与控制节点路由可达，目前仅支持经典网络（Default VPC）下的IP子网。
        - 角色：包括控制节点和计算节点。
        - 数量：设置创建相同配置，相同角色的虚拟机数量。
    - 版本：目前只支持 v1.17.0 版本的Kubernetes。
    - 镜像仓库：选择是否使用其他镜像仓库创建容器集群，如勾选，则需要设置镜像仓库的地址。
    - 镜像仓库地址：设置镜像仓库的地址。
3. 单击 **_"确定"_** 按钮，创建容器集群以及控制节点和计算节点等。

{{% alert title="注意" color="warning" %}}
单次创建的机器不超过10台。
{{% /alert %}}

## 导入集群

该功能用于导入已有集群到云管平台上进行管理，支持导入Kubernetes集群和OpenShift集群。导入的集群不支持节点管理等功能。

1. 在集群页面，单击列表上方 **_"导入"_** 按钮，进入导入集群页面。
2. 配置以下参数。
    - 名称：设置导入的集群的名称。
    - 发行版：选择集群类型，包括Kubernetes集群和OpenShift集群。
    - KubeConfig配置：复制已有集群的kubeconfig配置信息到该处粘贴即可。
3. 单击 **_"导入"_** 按钮，导入已有集群。

## 查看kubeconfig

kubeconfig文件可以帮助用户在客户端计算机通过kubectl连接到Kubernetes集群。

### 前提条件

确保客户端计算机已安装好kubectl客户端。

### 操作

1. 在集群页面，单击集群右侧操作列 **_"查看kubeconfig"_** 按钮，弹出集群kubeconfig对话框。
2. 单击 **_"复制"_** 按钮，复制kubeconfig内容到客户端计算机的$HOME/.kube/config。
    
    ```bash
    $ mkdir -p $HOME/.kube/
    $ touch $HOME/.kube/config    # 创建config文件
    $ vi $HOME/.kube/config   # 编辑config文件，并将复制的kubeconfig内容粘贴到config文件中
    ```

3. 在客户端计算机上执行下面命令验证是否可以通过kubectl命令管理集群。

    ```bash
    #获取集群节点
    $ kubectl get nodes  
    ```

{{% alert title="说明" %}}
kubectl相关命令请参考[kubectl参考文档](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands)
{{% /alert %}}

## 同步

该功能用于同步集群状态以及资源等。

1. 在集群页面，单击集群右侧操作列 **_"同步"_** 按钮，同步集群状态。

## 删除

该功能用于删除集群。

1. 在集群页面，单击集群右侧操作列 **_"删除"_** 按钮，弹出操作确认对话框。
2. 单击 **_"确定"_** 按钮，删除集群。

## 节点管理

该功能用于查看并管理集群中的节点。导入的集群不支持该操作。

### 添加节点

该功能用于在集群下添加节点。

1. 在集群页面，单击集群名称项，进入节点管理页面。
2. 单击列表上方 **_"添加节点"_** 按钮，弹出新建节点对话框。
3. 设置区域以及机器配置信息，支持添加多个节点，单击 **_"确定"_** 按钮，添加控制节点或计算节点。

### 删除节点

该功能用于在集群下删除节点。

**单个删除**

1. 在集群页面，单击集群名称项，进入节点管理页面。
2. 单击节点右侧操作列 **_"删除"_** 按钮，弹出操作确认对话框。
3. 单击 **_"确定"_** 按钮，完成操作。

**批量删除**

1. 在集群页面，单击集群名称项，进入节点管理页面。
2. 在节点列表中选择一个或多个节点，单击列表上方 **_"删除"_** 按钮，弹出操作确认对话框。
3. 单击 **_"确定"_** 按钮，完成操作。

## 查看操作日志

该功能用于查看集群相关操作的日志信息。

1. 在集群页面，单击集群名称项，进入集群详情页面。
    - 加载更多日志：列表默认显示20条操作日志信息，如需查看更多操作日志，请单击 **_"加载更多"_** 按钮，获取更多日志信息。
    - 查看日志详情：单击操作日志右侧操作列 **_"查看"_** 按钮，查看日志的详情信息。支持复制详情内容。
    - 查看指定时间段的日志：如需查看某个时间段的操作日志，在列表右上方的开始日期和结束日期中设置具体的日期，查询指定时间段的日志信息。
    - 导出日志：目前仅支持导出本页显示的日志。单击右上角![](../../../images/system/download.png)图标，在弹出的导出数据对话框中，设置导出数据列，单击 **_"确定"_** 按钮，导出日志。

